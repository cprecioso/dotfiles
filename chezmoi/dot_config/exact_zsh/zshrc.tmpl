#!/usr/bin/env zsh
# shellcheck shell=bash

autoload -Uz compinit

source "$HOME/.config/zsh/xdg-overrides.zsh" # hash: {{ include "./dot_config/exact_zsh/xdg-overrides.zsh" | sha256sum }}

nix_vars_file="/etc/profiles/per-user/$USER/etc/profile.d/hm-session-vars.sh"
if [ -f "$nix_vars_file" ]; then
  source "$nix_vars_file"
fi

zstyle :omz:plugins:iterm2 shell-integration yes # iTerm integration

# Initially disable the atuin shortcuts
export ATUIN_NOBIND="true"

# Antigen
source /opt/homebrew/share/antigen/antigen.zsh
antigen init "$HOME/.config/antigen/antigenrc" # hash: {{ include "./dot_config/exact_antigen/antigenrc" | sha256sum }}

# fzf
eval "$(fzf --zsh)"

# Restore atuin ctrl+r shortcut, overriding the fzf one
bindkey '^r' _atuin_search_widget

# `file` formula
export PATH="/opt/homebrew/opt/file-formula/bin:$PATH"

# brew completions
if type brew &>/dev/null; then
  FPATH=$(brew --prefix)/share/zsh-completions:$FPATH

  autoload -Uz compinit
  compinit
fi

# Alias
alias www="python3 -m http.server"

jabsorb() {
  file="$1"

  operation="$(jj op log -l 1 --no-graph --template id)"

  last_change_id="$(jj log --at-operation "$operation" -r '::@ ~ @' -l 1 --no-graph --template change_id "$file")"

  jj move --at-operation "$operation" --from @ --to "$last_change_id" "$file"
}

# Includes
# {{- if .new_work }}
# {{- "\n" -}} {{ includeTemplate "./dot_config/exact_zsh/.zshrc.new-work.tmpl" . }}
# {{- end }}

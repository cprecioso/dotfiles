#!/usr/bin/env zsh
# shellcheck shell=bash

compinit -d "$XDG_CACHE_HOME"/zsh/zcompdump-"$ZSH_VERSION"

# XDG Overrides
export ADOTDIR="$XDG_DATA_HOME"/antigen
export ANDROID_HOME="${XDG_DATA_HOME}"/android
export ASDF_DATA_DIR="${XDG_DATA_HOME}"/asdf
export AWS_CONFIG_FILE="${XDG_CONFIG_HOME}"/aws/config
export AWS_SHARED_CREDENTIALS_FILE="${XDG_CONFIG_HOME}"/aws/credentials
export BUNDLE_USER_CACHE="$XDG_CACHE_HOME"/bundle
export BUNDLE_USER_CONFIG="$XDG_CONFIG_HOME"/bundle
export BUNDLE_USER_PLUGIN="$XDG_DATA_HOME"/bundle
export CARGO_HOME="${XDG_DATA_HOME}"/cargo
export DOCKER_CONFIG="${XDG_CONFIG_HOME}"/docker
export GEM_HOME="${XDG_DATA_HOME}"/gem
export GEM_SPEC_CACHE="${XDG_CACHE_HOME}"/gem
export GNUPGHOME="${XDG_DATA_HOME}"/gnupg
export GOPATH="${XDG_DATA_HOME}"/go
export HISTFILE="$XDG_STATE_HOME"/zsh/history
export LESSHISTFILE="$XDG_STATE_HOME"/less/history
export MINIKUBE_HOME="${XDG_DATA_HOME}"/minikube
export MYSQL_HISTFILE="$XDG_DATA_HOME"/mysql_history
export NODE_REPL_HISTORY="$XDG_DATA_HOME"/node_repl_history
export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME"/npm/npmrc
export PYTHONSTARTUP="$XDG_CONFIG_HOME"/python/pythonrc
export RUSTUP_HOME="${XDG_DATA_HOME}"/rustup
export VAGRANT_HOME="$XDG_DATA_HOME"/vagrant

# shellcheck disable=SC2139
alias wget=wget --hsts-file="$XDG_DATA_HOME/wget-hsts"

. "/etc/profiles/per-user/$USER/etc/profile.d/hm-session-vars.sh"

zstyle :omz:plugins:iterm2 shell-integration yes # iTerm integration

# Initially disable the atuin shortcuts
export ATUIN_NOBIND="true"

# Antigen
source /opt/homebrew/share/antigen/antigen.zsh
antigen init "$HOME/.config/antigen/antigenrc" # hash: {{ include "./dot_config/exact_antigen/antigenrc" | sha256sum }}

# fzf
eval "$(fzf --zsh)"

# Restore atuin ctrl+r shortcut, overriding the fzf one
bindkey '^r' _atuin_search_widget

# `file` formula
export PATH="/opt/homebrew/opt/file-formula/bin:$PATH"

# brew completions
if type brew &>/dev/null; then
  FPATH=$(brew --prefix)/share/zsh-completions:$FPATH

  autoload -Uz compinit
  compinit
fi

# Alias
alias www="python3 -m http.server"

jabsorb() {
  file="$1"

  operation="$(jj op log -l 1 --no-graph --template id)"

  last_change_id="$(jj log --at-operation "$operation" -r '::@ ~ @' -l 1 --no-graph --template change_id "$file")"

  jj move --at-operation "$operation" --from @ --to "$last_change_id" "$file"
}

# Includes
# {{- if eq .type "new-work" }}
# {{- "\n" -}} {{ includeTemplate "./dot_config/exact_zsh/.zshrc.new-work.tmpl" . }}
# {{- end }}
